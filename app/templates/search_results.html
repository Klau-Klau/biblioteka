<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Wyniki Wyszukiwania</title>
    <style>
        .container {
            display: flex;
        }
        .filter-section {
            width: 20%;
        }
        .results-section {
            width: 80%;
        }
        /* Dodatkowe style dla przycisku koszyka rezerwacji */
        .reservation-cart-button {
            display: flex;
            justify-content: flex-end;
            padding: 10px 0;
        }
        .btn-primary {
            text-decoration: none;
            color: white;
            background-color: #007bff;
            border-color: #007bff;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Przycisk koszyka rezerwacji, który pokazuje się tylko zalogowanym czytelnikom -->
{% if current_user.is_authenticated and current_user.role == 'czytelnik' %}
<div class="reservation-cart-button">
    <a href="{{ url_for('reservation_cart') }}" class="btn btn-primary">Koszyk rezerwacji</a>
</div>
{% endif %}


    <div class="container">
        <div class="filter-section">
            <form action="{{ url_for('search_books') }}" method="get" id="filters">
                <h2>Filtry</h2>

                <label for="genre">Gatunek:</label>
                <select name="genre" id="genre" onchange="this.form.submit()">
                    <option value="" {{ 'selected' if genre == '' else '' }}> Wszystkie gatunki</option>
                    <option value="Przygodowa" {{ 'selected' if genre == 'Przygodowa' else '' }}>Przygodowa</option>
                    <option value="Fantasy" {{ 'selected' if genre == 'Fantasy' }}>Fantasy</option>
                    <option value="Klasyczna" {{ 'selected' if genre == 'Klasyczna' }}>Klasyczna</option>
                    <option value="Thriller" {{ 'selected' if genre == 'Thriller' }}>Thriller</option>
                    <option value="Dystopia" {{ 'selected' if genre == 'Dystopia' }}>Dystopia</option>
                    <option value="Literatura piękna" {{ 'selected' if genre == 'Literatura piękna' }}>Literatura piękna</option>
                </select><br>

                <label for="year">Rok wydania:</label>
                <select name="year" id="year" onchange="this.form.submit()">
                    <option value="" {{ 'selected' if year_range == '' }}>Wszystkie lata</option>
                    <option value="1900-1925" {{ 'selected' if year_range == '1900-1925' }}>1900 - 1925</option>
                    <option value="1925-1950" {{ 'selected' if year_range == '1925-1950' }}>1925 - 1950</option>
                    <option value="1950-1975" {{ 'selected' if year_range == '1950-1975' }}>1950 - 1975</option>
                    <option value="1975-2000" {{ 'selected' if year_range == '1975-2000' }}>1975 - 2000</option>
                    <option value="2000-2024" {{ 'selected' if year_range == '2000-2024' }}>2000 - 2024</option>
                </select><br>

                <label for="availability">Dostępność:</label>
                <select name="availability" id="availability" onchange="this.form.submit()">
                    <option value="" {{ 'selected' if availability == '' }}>Wszystkie</option>
                    <option value="Dostępne" {{ 'selected' if availability == 'Dostępne' }}>Dostępne</option>
                    <option value="Niedostępne" {{ 'selected' if availability == 'Niedostępne' }}>Niedostępne</option>
                </select><br>

                <label for="rating">Ocena książki:</label>
                <select name="rating" id="rating" onchange="this.form.submit()">
                    <option value="" {{ 'selected' if rating == '' }}>Wszystkie</option>
                    <option value="1" {{ 'selected' if rating == '1' }}>1</option>
                    <option value="2" {{ 'selected' if rating == '2' }}>2</option>
                    <option value="3" {{ 'selected' if rating == '3' }}>3</option>
                    <option value="4" {{ 'selected' if rating == '4' }}>4</option>
                    <option value="5" {{ 'selected' if rating == '5' }}>5</option>
                    <option></option>
                </select>

                <br>
                <br>
                <label for="sort">Sortuj według:</label>
                <select name="sort" id="sort" onchange="this.form.submit()">
    <option value="newest" {{ 'selected' if sort == 'newest' or sort is none }}>rok wydania: od najnowszych</option>
    <option value="oldest" {{ 'selected' if sort == 'oldest' }}>rok wydania: od najstarszych</option>
    <option value="highest_rating" {{ 'selected' if sort == 'highest_rating' }}>ocena: od najwyższej</option>
    <option value="lowest_rating" {{ 'selected' if sort == 'lowest_rating' }}>ocena: od najniższej</option>
    <option value="most_popular" {{ 'selected' if sort == 'most_popular' }}>popularność: od najbardziej popularnej</option>
    <option value="least_popular" {{ 'selected' if sort == 'least_popular' }}>popularność: od najmniej popularnej</option>
    <option value="alphabetical_a_z" {{ 'selected' if sort == 'alphabetical_a_z' }}>alfabetycznie: od A do Z</option>
    <option value="alphabetical_z_a" {{ 'selected' if sort == 'alphabetical_z_a' }}>alfabetycznie: od Z do A</option>
</select><br>


            </form>
        </div>

        <div class="results-section">
            {% if books %}
                <ul>
                    {% for book in books %}
    <li>
        {{ book.title }} - {{ book.author }} ({{ book.publication_year }})
        {% if current_user.is_authenticated and current_user.role == 'czytelnik' %}
            {% set available_copies = book.book_copies|selectattr('status', 'equalto', 'dostępna')|list %}
            {% if available_copies %}
                <form action="{{ url_for('add_to_cart') }}" method="post" class="add-to-cart">
                    <input type="hidden" name="book_copy_id" value="{{ available_copies[0].id }}">
                    <button type="submit">Dodaj do koszyka</button>
                </form>
            {% endif %}
        {% endif %}
    </li>
{% endfor %}

                </ul>
            {% else %}
                <p>Brak książek spełniających kryteria.</p>
            {% endif %}
        </div>
    </div>

    <!-- Sekcja do wyświetlania komunikatów flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</body>
</html>
