<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Zarządzanie książkami</title>

</head>
<body>
    <h1>Zarządzanie książkami</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    {% for book in books_with_details %}
    <h2>{{ book.title }} - {{ book.author }}</h2>
    <ul>
        {% for copy in book.book_copies %}
        <li>
            Egzemplarz nr: {{ loop.index }}, Status: {{ copy.status }}
            {% if copy.status == 'dostępna' %}
                <form action="{{ url_for('delete_book', copy_id=copy.id) }}" method="post">
                    <input type="submit" value="Usuń" onclick="return confirm('Czy na pewno chcesz usunąć ten egzemplarz?');">
                </form>
            {% elif copy.status == 'wypożyczona' %}
                <!-- Szczegóły wypożyczenia i formularz do zwrotu -->
                <form action="{{ url_for('return_book', copy_id=copy.id) }}" method="post">
                    <input type="submit" value="Zwrot książki">
                </form>
            {% elif copy.status == 'zarezerwowana' %}
                <!-- Szczegóły rezerwacji -->
                <p>Rezerwacja do: {{ copy.reservations[-1].due_date }} ({{ copy.reservations[-1].user.name }})</p>
                <!-- Formularz do oznaczenia książki jako gotowej do odbioru -->
                <form action="{{ url_for('book_ready_for_pickup', copy_id=copy.id) }}" method="post">
                    <input type="submit" value="Oznacz jako gotową do odbioru">
                </form>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% endfor %}
</body>
</html>
